<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OA Coder</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: transparent;
      overflow: hidden;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    /* Layout container */
    body {
      display: flex;
      flex-direction: column;
    }

    /* =========================
       TOP PROVIDER BAR
       ========================= */
    #top-bar {
      height: 42px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 8px;
      padding: 0 12px;
      background: rgba(0, 0, 0, 0.45);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index: 10;

      /* Allow window dragging from bar */
      -webkit-app-region: drag;
    }

    #top-bar button {
      background: rgba(255, 255, 255, 0.12);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;

      /* Buttons must NOT be draggable */
      -webkit-app-region: no-drag;
    }

    #top-bar button:hover {
      background: rgba(255, 255, 255, 0.25);
    }

    #top-bar button.active {
      background: rgba(255, 255, 255, 0.35);
    }

    /* =========================
       WEBVIEW
       ========================= */
    webview {
      flex: 1;
      width: 100%;
      border-radius: 0 0 14px 14px;
      background: transparent;
    }
  </style>
</head>

<body>

  <!-- Provider Switcher Bar -->
  <div id="top-bar">
    <button id="btn-chatgpt" onclick="switchProvider('chatgpt')">ChatGPT</button>
    <button id="btn-gemini" onclick="switchProvider('gemini')">Gemini</button>
    <button id="btn-perplexity" onclick="switchProvider('perplexity')">Perplexity</button>
  </div>

  <!-- AI WebView -->
  <webview
    id="ai"
    allow="microphone; camera; speaker"
    allowpopups
  ></webview>

  <script>
    const params = new URLSearchParams(window.location.search);
    const url = params.get('url');
    const partition = params.get('partition');
    const provider = params.get('provider');

    const webview = document.getElementById('ai');
    webview.src = url;
    webview.partition = partition;

    // Highlight active provider
    if (provider) {
      const btn = document.getElementById(`btn-${provider}`);
      if (btn) btn.classList.add('active');
    }

    function switchProvider(provider) {
      window.oa.switchProvider(provider);
    }

    webview.addEventListener('dom-ready', () => {
      console.log('Loaded:', url, 'Partition:', partition);
    });
  </script>

</body>
</html>
